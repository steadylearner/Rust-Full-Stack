<!--
    Post{
        subtitle: "Learn how to dockerize Rust web projects."
        image: "post/Rust/docker-rust.png",
        image_decription: "Image by Steadylearner",
        tags: "How Docker Rust Actix",
    }
-->

<!-- Link -->

[Steadylearner]: https://www.steadylearner.com
[Rust Website]: https://www.rust-lang.org/

[Rust Rocket]: https://rocket.rs/
[Rocket Getting Started]: https://rocket.rs/v0.4/guide/getting-started
[Rocket JSON Example]: https://github.com/SergioBenitez/Rocket/tree/master/examples/json
[Redirect]: https://api.rocket.rs/v0.4/rocket/response/struct.Redirect.html
[Tera]: https://tera.netlify.com/
[Rocket Tera example]: https://github.com/SergioBenitez/Rocket/tree/master/examples/tera_templates

[CORS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS
[OPTIONS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS
[Rocket CORS]: https://github.com/lawliet89/rocket_cors
[Rocket CORS examples]: https://github.com/lawliet89/rocket_cors/tree/master/examples
[Rocket CORS fairing example]: https://github.com/lawliet89/rocket_cors/blob/master/examples/fairing.rs
[Rocket CORS fairng test example]: https://github.com/lawliet89/rocket_cors/blob/master/tests/fairing.rs

[Rust Yew Examples]: https://github.com/yewstack/yew/tree/master/examples

[hyper]: https://github.com/hyperium/hyper

[Rust Dotenv]: https://crates.io/crates/dotenv
[Reqwest]: https://docs.rs/reqwest/0.9.18/reqwest/

[stdweb]: https://github.com/koute/stdweb

[YouTube API]: https://developers.google.com/youtube/v3/getting-started#before-you-start
[How to use YouTube API for developers]: https://www.google.com/search?q=how+to+use+youtube+api+for+developers

[Rust Full Stack]: https://github.com/steadylearner/Rust-Full-Stack
[JSON Webservice]: https://github.com/steadylearner/Rust-Full-Stack/tree/master/before/JSON_Webservice

[Rust Blog Example]: https://github.com/steadylearner/Rust-Full-Stack/tree/master/web/before/rust_blog

[CRA]: https://github.com/facebook/create-react-app

[protocol buffers]: https://developers.google.com/protocol-buffers/docs/overview
[Tonic]: https://github.com/hyperium/tonic
[Rust Postgresql]: https://github.com/sfackler/rust-postgres
[Rust Postgresql query]: https://docs.rs/postgres/0.15.2/postgres/struct.Connection.html#method.query
[Rust Postgresql execute]: https://docs.rs/postgres/0.15.2/postgres/struct.Connection.html#method.execute
[Tonic CRUD Example by Steadylearner]: https://github.com/steadylearner/Rust-Full-Stack/blob/master/grpc/user/proto/user/user.proto
[Official Tonic Guide]: https://github.com/hyperium/tonic/blob/master/tonic-examples/helloworld-tutorial.md
[gRPC Client]: https://github.com/uw-labs/bloomrpc

[How to install Postgresql]: https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04

[tonic-build]: https://github.com/hyperium/tonic/blob/master/tonic-build/README.md

[Rust uuid]: https://crates.io/crates/uuid
[chrono]: https://docs.rs/chrono/0.4.9/chrono/

[graphiql]: https://github.com/graphql/graphiql

[React Rust]: https://github.com/steadylearner/React-Rust
[React Router]: https://github.com/ReactTraining/react-router

<!-- / -->

<!-- Steadylearner Post -->

[Rust blog posts]: https://www.steadylearner.com/blog/search/Rust
[How to install Rust]: https://www.steadylearner.com/blog/read/How-to-install-Rust
[Rust Chat App]: https://www.steadylearner.com/blog/read/How-to-start-Rust-Chat-App
[Rust Yew Frontend]: https://github.com/yewstack/yew
[Yew Counter]: https://www.steadylearner.com/yew_counter
[How to use Rust Yew]: https://www.steadylearner.com/blog/read/How-to-use-Rust-Yew
[How to deploy Rust Web App]: https://www.steadylearner.com/blog/read/How-to-deploy-Rust-Web-App
[How to start Rust Chat App]: https://www.steadylearner.com/blog/read/How-to-start-Rust-Chat-App
[Fullstack Rust with Yew]: https://www.steadylearner.com/blog/read/Fullstack-Rust-with-Yew
[How to use NPM packages with Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-use-NPM-packages-with-Rust-Frontend
[How to use markdown with code snippets in Rust Yew Frontend]: https://www.steadylearner.com/blog/read/How-to-use-markdown-with-code-snippets-in-Rust-Yew-Frontend
[How to modulize your Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-modulize-your-Rust-Frontend
[How to write Full Stack Rust Code]: https://www.steadylearner.com/blog/read/How-to-write-Full-Stack-Rust-code
[How to use a modal in Rust]: https://www.steadylearner.com/blog/read/How-to-use-a-modal-in-Rust
[How to use routers in Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-use-routers-in-Rust-Frontend
[How to serve static files with Rust]: https://www.steadylearner.com/blog/read/How-to-serve-static-files-with-Rust
[How to use a single page app wtih Rust]: https://www.steadylearner.com/blog/read/How-to-use-a-single-page-app-with-Rust
[How to use Rust Tera for undefined paths]: https://www.steadylearner.com/blog/read/How-to-use-Rust-Tera-for-undefined-paths
[How to make JSON Webservice with Rust and YouTube API]: https://www.steadylearner.com/blog/read/How-to-make-JSON-Webservice-with-Rust-and-YouTube-API
[How to use CORS and OPTIONS HTTP request with Rust Rocket]: https://www.steadylearner.com/blog/read/How-to-use-CORS-and-OPTIONS-HTTP-request-with-Rust-Rocket
[How to render a YouTube vlog with Rust Yew fetch API]: https://www.steadylearner.com/blog/read/How-to-render-a-YouTube-vlog-with-Rust-Yew-fetch-API

[How to use Python in JavaScript]: https://www.steadylearner.com/blog/read/How-to-use-Python-in-JavaScript
[How to use React Spring to animate your message]: https://medium.com/@steadylearner/how-to-use-react-spring-to-animate-your-message-2bd2a7e62a5a

[How to use Webpack with React]: https://www.steadylearner.com/blog/read/How-to-use-Webpack-with-React
[Actix]: https://github.com/actix/actix-web
[How to use Docker commands]: https://www.steadylearner.com/blog/read/How-to-use-Docker-commands
[How to use React with Rust Actix]: https://www.steadylearner.com/blog/read/How-to-use-React-with-Rust-Actix

<!-- / -->

<!-- Steadylearner Twitter and LinkedIn  -->

[Twitter]: https://twitter.com/steadylearner_p
[LinkedIn]: https://www.linkedin.com/in/steady-learner-3151b7164/

<!--  -->

In this post, we will learn how to use [Docker][How to use Docker commands] with Rust web frameworks.

We already have React and Rust server side code ready at [React Rust]. Clone the repository or use the Docker to see the result first.

```console
$docker run -d -p 80:8000 steadylearner/rust && curl localhost
``` 

Then, the result will be similar to this.

[![user-signup](https://www.steadylearner.com/static/images//post/React/user-signup.png)][React Rust]

<br />

<h2 class="red-white">[Prerequisite]</h2>

1. Docker
2. Rust

---

I will assume that you are already familiar with Docker and Rust. If you haven't used Docker commands yet, please read [How to use Docker commands].

<br />

<h2 class="blue">Table of Contents</h2>

1. Target **0.0.0.0:** to use your project with Docker
2. Prepare files to use
3. Make a Docker image with Dockerfile
4. Verify the result in your machine
5. Conclusion

---

<br />

## 1. Target 0.0.0.0: to use your project with Docker

This is maybe the simplest but most important part to save your time. Verify your server side code. In server/actix/src/main.rs of [React Rust], you can see the code similar to this.

```rust
extern crate actix_web;
extern crate actix_files;
extern crate console;

use actix_files as fs;
use actix_web::{App, HttpServer, web, middleware, Result, Responder};

use std::path::PathBuf;

use console::Style;

fn single_page_app() -> Result<fs::NamedFile> {
    let path: PathBuf = PathBuf::from("./public/index.html");
    Ok(fs::NamedFile::open(path)?)
}

pub fn main() {
    std::env::set_var("RUST_LOG", "actix_web=info");
    env_logger::init();

    let blue = Style::new()
        .blue();

    let prefix = "0.0.0.0:";
    let port = 8000; // We will use 80 for aws with env variable.
    let target = format!("{}{}", prefix, port);

    println!("\nServer ready at {}", blue.apply_to(format!("http://{}",&target)));

    HttpServer::new(|| {
        App::new()
            .wrap(middleware::Logger::default())
            .route("/", web::get().to(single_page_app))
            .route("/user", web::get().to(single_page_app))
            .service(fs::Files::new("/", "./public").index_file("index.html"))
    })
    .bind(&target) // Separate prefix, port, target, println! not to show "Not registered service error"
    .unwrap()
    .run()
    .unwrap();
}
```

**Never ever** use **localhost** or **127.0.0.1** etc and only use ports that start with **0.0.0.0:** if you want to containerize your project with Docker later. This is the same for other web frameworks also.

The port **8000** is used here to synchronize with React frontend made with Webpack. You can use 80 instead when you want to deploy it to AWS. We will learn how to do that in the later [Rust blog posts].

If you want more information of the code used here, please read [How to use React with Rust Actix].

<br />

## 2. Prepare files to use

Rust is compiled language. When you use **cargo run --release**, it makes an executable binary file at **target/release/**.

Its name will be equal to your project name at **Cargo.toml** and will be **react_actix**.

```toml
[package]
name = "react_actix"
```

We don't need other files made from Rust other than that.

We also have some static files for React frontend code to work at **public** folder.

To sum up, you just need to find how to include these to a Docker image we will make.

1. **react_actix**
2. **public** folder

It will be no different to use these commands in your console to test it separately in your machine.

```console
$mkdir Docker
$cp react_actix Docker
$cp -R public Docker
$mv Docker && ./react_actix
```

<br />

## 3. Make a Docker image with Dockerfile

In the previous part, we already learnt which files to include in your Docker container.

What left is to decide which base **Docker image** to use and write a few commands in Dockerfile to make all work.

For it is Rust project, it is easy to think we need [the Rust official image from the Dockerhub](https://hub.docker.com/_/rust).

But, we don't need it for we can just execute the **react_actix** binary project with **$./react_actix** inside a Docker container.

You can compare the results.

1. Whatever OS you use in your machine.

```json
{
    "ubuntu": "64.2MB",
    "with_project": "78.4MB"
}
```

2. With Rust official Docker image.

```json
{
    "rust": "1.62GB",
    "with_project": "1.64GB"
}
```

For we already know the difference, we will finally make a **Dockerfile**. It is just the file to include commands we used manually before in [How to use Docker commands].

**It will make a Docker image and not a container** and will be similar to this.

```toml
FROM ubuntu # 1.
WORKDIR /app # 2.
# 3.
COPY ./public /app/public
COPY ./target/release/react_actix /app
EXPOSE 8000 # 4.
CMD ["./react_actix"] #5.
```

The process is just to make a virtual development environment similar to your mahcine with Docker. Then, you help it to execute few commands we read in the previous part.

**1.** Use OS or base Docker image you want.

**2.** Use whatever folder name you want for your project.

**3.** We need static files for React frontend and an executable binary file for **Rust**.

You will only need **COPY ./target/release/react_actix /app** if your project is without the frontend code.

**4.** Expose the port you use in your project outside of your docker container.

You can easily verify it with **$curl localhost** later.

**5.** We execute the Rust web app with this. Nothing complicated here.

For **Dockerfile** is ready, make a **./docker-build.bash** file similar to this to make a Docker image with it.

```bash
docker build -t youraccount/rust .
```

Execute it with **./docker-build.bash**. It won't take a long time for Docker to build the image.

Then, you can verify the result with **$docker images**. It will be similar to this.

```console
REPOSITORY              TAG
youraccount/rust          latest
```

<br />

## 4. Verify the result in your machine

The prepartion ends. Make the Docker conatiner from the image you made with this command.

```console
$docker run -d -p 80:8000 steadylearner/rust
```

You can verify the Docker container is made from the image with this **$docker ps -a**.

It will show the message similar to this.

```console
COMMAND        PORTS
"./react_actix"    0.0.0.0:80->8000/tcp
```

We exposed **8000** port in the previous part. The result of it is **8000/tcp** above.

Then, we used port mapping with **-p 80:8000** to test it easily with **curl** and you can see it worked with this.

```console
PORTS
0.0.0.0:80->8000/tcp
```

Everything is ready. Use **$curl localhost** or visit it with your browser. Refresh it also at **/**, **/user** to verify the Rust server side code working well.

If you want, you can push this to DockerHub with a command similar to **$docker push youraccount/rust**.

It is similar to use GitHub and you should make an account and make a repository first.

<br />

## 5. Conclusion

I hope you made it all work. We learnt how to dockerize Rust web app.

We used React production files to make it more meaningful. You could use whatever static files or without them also.

In the later [Rust blog posts], we will learn how to deploy Rust Docker images to **AWS**. It won't be difficult for we have various examples already at [React Rust] you can compare.

Finding working Rust code is not easy, so I use Express and other frameworks to prototype the projects and write blog posts for them also. If you want to experiment them, please refer to [React Rust] repository.

If you want the latest contents from Steadylearner, follow me at [Twitter] or star [Rust Full Stack].

Do you need **a Full Stack Developer who can use Docker and AWS to deploy the projects**? Contact me with [LinkedIn] or [Twitter] and I will help you.

You can invite me to work with your team. I can learn fast if there is a reason for that.
