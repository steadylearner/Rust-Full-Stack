<!--
    Post{
        subtitle: "Learn how to serve static files with Rust Actix."
        image: "post/web/react-actix.png",
        image_decription: "Image by Steadylearner",
        tags: "How React Actix Rust",
    }
-->

<!-- Link -->

[Steadylearner]: https://www.steadylearner.com
[Rust Website]: https://www.rust-lang.org/

[Rust Rocket]: https://rocket.rs/
[Rocket Getting Started]: https://rocket.rs/v0.4/guide/getting-started
[Rocket JSON Example]: https://github.com/SergioBenitez/Rocket/tree/master/examples/json
[Redirect]: https://api.rocket.rs/v0.4/rocket/response/struct.Redirect.html
[Tera]: https://tera.netlify.com/
[Rocket Tera example]: https://github.com/SergioBenitez/Rocket/tree/master/examples/tera_templates

[CORS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS
[OPTIONS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS
[Rocket CORS]: https://github.com/lawliet89/rocket_cors
[Rocket CORS examples]: https://github.com/lawliet89/rocket_cors/tree/master/examples
[Rocket CORS fairing example]: https://github.com/lawliet89/rocket_cors/blob/master/examples/fairing.rs
[Rocket CORS fairng test example]: https://github.com/lawliet89/rocket_cors/blob/master/tests/fairing.rs

[Rust Yew Examples]: https://github.com/yewstack/yew/tree/master/examples

[hyper]: https://github.com/hyperium/hyper

[Rust Dotenv]: https://crates.io/crates/dotenv
[Reqwest]: https://docs.rs/reqwest/0.9.18/reqwest/

[stdweb]: https://github.com/koute/stdweb

[YouTube API]: https://developers.google.com/youtube/v3/getting-started#before-you-start
[How to use YouTube API for developers]: https://www.google.com/search?q=how+to+use+youtube+api+for+developers

[Rust Full Stack]: https://github.com/steadylearner/Rust-Full-Stack
[JSON Webservice]: https://github.com/steadylearner/Rust-Full-Stack/tree/master/before/JSON_Webservice

[Rust Blog Example]: https://github.com/steadylearner/Rust-Full-Stack/tree/master/web/before/rust_blog

[CRA]: https://github.com/facebook/create-react-app

[protocol buffers]: https://developers.google.com/protocol-buffers/docs/overview
[Tonic]: https://github.com/hyperium/tonic
[Rust Postgresql]: https://github.com/sfackler/rust-postgres
[Rust Postgresql query]: https://docs.rs/postgres/0.15.2/postgres/struct.Connection.html#method.query
[Rust Postgresql execute]: https://docs.rs/postgres/0.15.2/postgres/struct.Connection.html#method.execute
[Tonic CRUD Example by Steadylearner]: https://github.com/steadylearner/Rust-Full-Stack/blob/master/grpc/user/proto/user/user.proto
[Official Tonic Guide]: https://github.com/hyperium/tonic/blob/master/tonic-examples/helloworld-tutorial.md
[gRPC Client]: https://github.com/uw-labs/bloomrpc

[How to install Postgresql]: https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04

[tonic-build]: https://github.com/hyperium/tonic/blob/master/tonic-build/README.md

[Rust uuid]: https://crates.io/crates/uuid
[chrono]: https://docs.rs/chrono/0.4.9/chrono/

[graphiql]: https://github.com/graphql/graphiql

[React Rust]: https://github.com/steadylearner/React-Rust
[React Router]: https://github.com/ReactTraining/react-router

<!-- / -->

<!-- Steadylearner Post -->

[Rust blog posts]: https://www.steadylearner.com/blog/search/Rust
[How to install Rust]: https://www.steadylearner.com/blog/read/How-to-install-Rust
[Rust Chat App]: https://www.steadylearner.com/blog/read/How-to-start-Rust-Chat-App
[Rust Yew Frontend]: https://github.com/yewstack/yew
[Yew Counter]: https://www.steadylearner.com/yew_counter
[How to use Rust Yew]: https://www.steadylearner.com/blog/read/How-to-use-Rust-Yew
[How to deploy Rust Web App]: https://www.steadylearner.com/blog/read/How-to-deploy-Rust-Web-App
[How to start Rust Chat App]: https://www.steadylearner.com/blog/read/How-to-start-Rust-Chat-App
[Fullstack Rust with Yew]: https://www.steadylearner.com/blog/read/Fullstack-Rust-with-Yew
[How to use NPM packages with Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-use-NPM-packages-with-Rust-Frontend
[How to use markdown with code snippets in Rust Yew Frontend]: https://www.steadylearner.com/blog/read/How-to-use-markdown-with-code-snippets-in-Rust-Yew-Frontend
[How to modulize your Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-modulize-your-Rust-Frontend
[How to write Full Stack Rust Code]: https://www.steadylearner.com/blog/read/How-to-write-Full-Stack-Rust-code
[How to use a modal in Rust]: https://www.steadylearner.com/blog/read/How-to-use-a-modal-in-Rust
[How to use routers in Rust Frontend]: https://www.steadylearner.com/blog/read/How-to-use-routers-in-Rust-Frontend
[How to serve static files with Rust]: https://www.steadylearner.com/blog/read/How-to-serve-static-files-with-Rust
[How to use a single page app wtih Rust]: https://www.steadylearner.com/blog/read/How-to-use-a-single-page-app-with-Rust
[How to use Rust Tera for undefined paths]: https://www.steadylearner.com/blog/read/How-to-use-Rust-Tera-for-undefined-paths
[How to make JSON Webservice with Rust and YouTube API]: https://www.steadylearner.com/blog/read/How-to-make-JSON-Webservice-with-Rust-and-YouTube-API
[How to use CORS and OPTIONS HTTP request with Rust Rocket]: https://www.steadylearner.com/blog/read/How-to-use-CORS-and-OPTIONS-HTTP-request-with-Rust-Rocket
[How to render a YouTube vlog with Rust Yew fetch API]: https://www.steadylearner.com/blog/read/How-to-render-a-YouTube-vlog-with-Rust-Yew-fetch-API

[How to use Python in JavaScript]: https://www.steadylearner.com/blog/read/How-to-use-Python-in-JavaScript
[How to use React Spring to animate your message]: https://medium.com/@steadylearner/how-to-use-react-spring-to-animate-your-message-2bd2a7e62a5a

[How to use Webpack with React]: https://www.steadylearner.com/blog/read/How-to-use-Webpack-with-React
[Actix]: https://github.com/actix/actix-web

<!-- / -->

<!-- Steadylearner Twitter and LinkedIn  -->

[Twitter]: https://twitter.com/steadylearner_p
[LinkedIn]: https://www.linkedin.com/in/steady-learner-3151b7164/

<!--  -->

In this post, we will learn how to use React with Actix. We will make a very simple Actix project that serves React production files. You will find how it is easy to do that.

If you want the result first, refer to **react-rust** folder in [Rust Full Stack] repository. It will be with Rust Rocket framework example also. 

For we already learnt how to use it to serve static files with [How to serve static files with Rust] and [How to use a single page app wtih Rust], we won't need the detailed explanation for it. 

Just use **./rocket.bash** file if you want to test it also. You can also use [React Rust] if you want the latest contents.

<br />

<h2 class="red-white">[Prerequisite]</h2>

1. React with Webpack
2. Actix

---

If you haven't installed Rust in your machine, read [How to install Rust]. We will use [React with Webpack][How to use Webpack with React] for this post.

I will assume that you are already familiar with Rust, React and Webpack. Otherwise, please read the documentations for them thoroughly.

You can also use [CRA] or whatever frontend frameworks you want to build static production files. What you will really learn in this post is how to serve static files in **public** folder and **a static file with a route**.

<br />

<h2 class="blue">Table of Contents</h2>

1. Prepare React production files
2. Set up Actix routes to serve them
3. Conclusion

---

<br />

## 1. Prepare React production files

I hope you already have static files from React or whatever framework you use. Otherwise, you can use the same files used at  [React Rust].

Clone the repository and use the **./install.bash** file there. Then, **yarn build** to make React production files.

You will see index.html, main.css, main.js, vendors.js etc at **dist/** folder.

When we serve them with Actix, the result will be similar to this.

[![user-signup](https://www.steadylearner.com/static/images//post/React/user-signup.png)][React Rust]

<br />

## 2. Set up Actix routes to serve them

If you have tested the React app already, you will find it has only two routes **/** and **/user** with [React Router] API and images, CSS, and production JavaScript files to help them.

Therefore, the Rust Actix code will be very simple. We just need to learn **how to serve static files** and make two routes for **/** and **/user** in server side to serve the entry point **index.html** when user refreshes the page.

For that, prepare the dependencies with **Cargo.toml** first.

```toml
[package]
name = "react_rust_actix"
version = "0.1.0"
authors = ["www.steadylearner.com"]
edition = "2018"

[dependencies]
actix-web = "1.0.8"
actix-files = "0.1.6"
futures = "0.1.29"
bytes = "0.4.12"
env_logger = "0.7.1"
serde = "1.0.101"
serde_json = "1.0.41"
serde_derive = "1.0.101"
json = "0.12.0"
console = "0.9.0"
```

Then, write a **src/main.rs** with Actix API. It will be similar to this.

```rust
extern crate actix_web;
extern crate actix_files;
extern crate console;

use actix_files as fs;
use actix_web::{App, HttpServer, web, middleware, Result, Responder};

use std::path::PathBuf;

use console::Style;

fn single_page_app() -> Result<fs::NamedFile> {
    // 1.
    let path: PathBuf = PathBuf::from("./public/index.html");
    Ok(fs::NamedFile::open(path)?)
}

pub fn main() {
    std::env::set_var("RUST_LOG", "actix_web=info");
    env_logger::init();

    let blue = Style::new()
        .blue();
    
    // 2.
    let prefix = "0.0.0.0:"; // // Use 0.0.0.0 instead of localhost or 127.0.0.1 to use Actix with docker
    let port = 8000; // We will use 80 for aws with env variable.
    let target = format!("{}{}", prefix, port);

    println!("\nServer ready at {}", blue.apply_to(format!("http://{}",&target)));

    HttpServer::new(|| {
        App::new()
            .wrap(middleware::Logger::default())
            // 3.
            .route("/", web::get().to(single_page_app))
            .route("/user", web::get().to(single_page_app))
            .service(fs::Files::new("/", "./public").index_file("index.html"))
    })
    .bind(&target) // Separate prefix, port, target, println! not to show "Not registered service error"
    .unwrap()
    .run()
    .unwrap();
}
```

Little code here but we should learn some important points.

**1.** You should read the documentation for [PathBuf](https://doc.rust-lang.org/std/path/struct.PathBuf.html). Watch out for where you use **$cargo run --build**. If it were not in the top directory of your project, it won't work.

Use **single_page_app** ,,**react** or whatever you want for the function name. What left will be just to pass it in route API. For it is already the entry point of React production files, you won't need to edit this part anymore.

**2.** Use **0.0.0.0:8000** port to help Actix web synchronize with React production files. It will help you deploy your app easily later with Docker or whatever you will use.

**3.** We already know the React app has **/** and **/user** parts. So define them in server side also to help users can see the pages when they refresh your website.

Then, we use **.service(fs::Files::new("/", "./public").index_file("index.html"))** to [serve every static files](https://docs.rs/actix-files/0.1.7/actix_files/struct.Files.html) in **public** folder at the top level directory. With this Rust Actix API, you don't have to make routes for every static files in it.

The sequence here is important. When you put those routes for **/** and **/user**. It will serve **index.html** from **single_page_app** first before API to serve files in **public**.

If you are curious, you can put **.service(fs::Files::new("/", "./public").index_file("index.html"))** before all other routes and test it(Normally, you won't make files without extensions and won't want to see the errors "there is no files such as **user** in **public** directory").

The **route("/", web::get().to(single_page_app))** part may be optional depending on the framework or language you use for the same purpose. Please, refer to [React Rust]. It has **Express**, **Restify**, **Rocket**, **Actix**, **Vibora**, **Golang** examples etc to help you compare them.

If you haven't yet, test your project with **cargo run --release**. Then, visit **/**, **/user** and refresh the page also. If all worked well, you already have Actix project to serve React single page apps without a problem.

If your project have more routes in frontend like [Steadylearner], just copy and paste the code we have.

```rust
route("/", web::get().to(single_page_app))
route("/about", web::get().to(single_page_app))
route("/code", web::get().to(single_page_app))
route("/blog", web::get().to(single_page_app))
```

Just make routes to serve **single_page_app** for every pages you defined in **React** or whatever frontend frameworks.

<br />

## 3. Conclusion

I hope you made it work. We learnt how to serve static files in **public** folder and **index.html** file for a route in Actix.

We used React production files to make it more meaningful. You could also use whatever static files for this project.

In the later [Rust blog posts], we will have more [Actix] examples with Login, Docker etc.

Finding working Rust code is not easy, so I use Express and other frameworks to prototype the projects and write blog posts for them also. If you want to experiment them, please refer to [React Rust] repository.

If you want the latest contents from Steadylearner, follow me at [Twitter] or star [Rust Full Stack].

Do you need **a Full Stack Rust Developer**? Contact me with [LinkedIn] or [Twitter] and I will help you.

You can invite me to work with your team. I can learn fast if there is a reason for that.
